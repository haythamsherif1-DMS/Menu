function liveSearch(query) {
    const itemsArea = document.getElementById('itemsArea');
    const categoriesView = document.getElementById('categoriesView');
    const itemsGrid = document.getElementById('itemsGrid');
    const sectionTitle = document.getElementById('sectionTitle');

    if (query.trim() === "") {
        // إذا كان البحث فارغاً، نعود لعرض الأقسام
        backToCategories();
        return;
    }

    // إظهار منطقة المنتجات وإخفاء الأقسام
    categoriesView.classList.add('hidden');
    itemsArea.classList.remove('hidden');
    sectionTitle.innerText = "نتائج البحث عن: " + query;

    // فلترة المصفوفة بناءً على الاسم أو الوصف
    const filteredItems = menuItems.filter(item => 
        item.name.toLowerCase().includes(query.toLowerCase()) || 
        item.desc.toLowerCase().includes(query.toLowerCase()) ||
        item.category.toLowerCase().includes(query.toLowerCase())
    );

    // عرض النتائج
    if (filteredItems.length > 0) {
        renderItems(filteredItems, itemsGrid, true);
    } else {
        itemsGrid.innerHTML = `
            <div class="col-span-full text-center py-10">
                <i class="fas fa-search flex justify-center text-4xl text-gray-300 mb-3"></i>
                <p class="theme-text-body opacity-60">عذراً، لم نجد نتائج تطابق بحثك</p>
            </div>
        `;
    }
}

// تعديل بسيط على وظيفة renderItems لتناسب البحث (تأكد من وجود الوظيفة الأصلية لديك)
// سنقوم بتمرير المعامل الثالث 'true' ليعرف أنها من البحث
function renderItems(items, container, isOrderView) {
    container.innerHTML = items.map(item => `
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border theme-border overflow-hidden flex flex-col h-full transition-transform hover:scale-[1.01]">
            <div class="relative h-40">
                <img src="${item.img}" class="w-full h-full object-cover">
                <div class="absolute top-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-lg backdrop-blur-sm">
                    ${item.category}
                </div>
            </div>
            <div class="p-3 flex flex-col flex-1">
                <h4 class="font-bold theme-text-header text-base mb-1">${item.name}</h4>
                <p class="text-xs theme-text-body opacity-70 mb-3 line-clamp-2">${item.desc}</p>
                <div class="mt-auto flex items-center justify-between">
                    <span class="font-black text-primary">${item.options[0].price} ج</span>
                    ${isOrderView ? 
                        `<button onclick='openOptionModal(${JSON.stringify(item).replace(/'/g, "&apos;")})' class="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                            <i class="fas fa-plus text-xs"></i>
                        </button>` : ''
                    }
                </div>
            </div>
        </div>
    `).join('');
}
