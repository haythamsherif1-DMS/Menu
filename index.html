<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NOUR Menu â€” Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#528d55',
                    }
                }
            }
        }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠØ© */
        * { -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            overflow-x: hidden;
            background: var(--bg-menu); 
            transition: background-color 0.3s ease, color 0.3s ease;
            touch-action: manipulation;
        }

        #app-splash {
            position: fixed; inset: 0; background-color: #fff7ed; z-index: 99999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-out;
        }
        .splash-logo-container {
            width: 120px; height: 120px; background: white; border-radius: 25px; padding: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center;
            animation: pulseLogo 2s infinite;
        }
        @keyframes pulseLogo { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .loading-bar-container {
            width: 150px; height: 4px; background: #fed7aa; border-radius: 10px; overflow: hidden; margin-top: 15px; position: relative;
        }
        .loading-bar {
            width: 50%; height: 100%; background: #ea580c; position: absolute; left: -50%;
            animation: loadMove 1.5s infinite linear;
        }
        @keyframes loadMove { 0% { left: -50%; } 100% { left: 150%; } }

        :root {
            --bg-menu: #f9fafb; --card-bg: #ffffff; --glass: rgba(255, 255, 255, 0.9); 
            --header-color: #431407; --text-color: #1f2937; --muted: #6b7280; --border-color: #e5e7eb;
        }
        html.dark :root {
            --bg-menu: #0f172a; --card-bg: #1e293b; --glass: rgba(30, 41, 59, 0.95);
            --header-color: #f3f4f6; --text-color: #e2e8f0; --muted: #94a3b8; --border-color: #374151;
        }
        
        .theme-bg { background-color: var(--bg-menu); }
        .theme-text-header { color: var(--header-color); }
        .theme-text-body { color: var(--text-color); }
        .theme-border { border-color: var(--border-color); }

        .glass { background: var(--glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color); }
        .items-carousel { display: grid; gap: 1rem; padding-bottom: 6rem; grid-template-columns: 1fr; }
        @media(min-width: 640px) { .items-carousel { grid-template-columns: repeat(2, 1fr); } }
        @media(min-width: 1024px) { .items-carousel { grid-template-columns: repeat(3, 1fr); } }

        .view-section { display: none; min-height: 100vh; padding-bottom: 80px; }
        .view-section.active { display: block; animation: fadeInView 0.4s ease-out; }
        @keyframes fadeInView { from { opacity: 0; } to { opacity: 1; } }

        .btn-add:active { transform: scale(0.95); }
        .option-button { transition: all 0.2s; border: 2px solid var(--border-color); }
        .option-button.selected { border-color: #528d55; background-color: #ecfdf5; }
        html.dark .option-button.selected { background-color: #064e3b; }
    </style>
</head>
<body class="text-gray-800" id="pageRoot">

    <div id="app-splash">
        <div class="splash-logo-container">
            <img src="https://nour2030.neocities.org/NOUR%20Menu/Nour%20Menu.png" alt="Logo" style="width:100%; height:100%; object-fit:contain; border-radius:15px;">
        </div>
        <h1 class="text-3xl font-black text-gray-800 mb-2">NOUR MENU</h1>
        <p class="text-sm text-gray-500 font-medium">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</p>
        <div class="loading-bar-container"><div class="loading-bar"></div></div>
    </div>

    <div id="view-landing" class="view-section active">
        <div class="flex items-center justify-center min-h-screen p-4 bg-orange-50/50">
            <div class="w-full max-w-md bg-white shadow-2xl rounded-3xl overflow-hidden border border-orange-100 relative">
                <div class="absolute top-4 left-4 z-10 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold shadow animate-bounce">Ø¬Ø¯ÙŠØ¯! ğŸ”¥</div>
                <div class="h-64 relative">
                    <img src="https://nour2030.neocities.org/NOUR%20Menu/Nour%20Menu.png" class="w-full h-full object-cover">
                    <div class="absolute bottom-0 inset-x-0 h-24 bg-gradient-to-t from-white to-transparent"></div>
                </div>
                <div class="px-6 pb-8 -mt-10 relative z-10">
                    <div class="flex justify-center mb-4">
                        <div class="bg-white p-2 rounded-2xl shadow-lg border border-orange-100 w-24 h-24 flex items-center justify-center">
                            <img src="https://nour2030.neocities.org/NOUR%20Menu/Nour%20Menu.png" class="w-full h-full object-contain rounded-lg">
                        </div>
                    </div>
                    <div class="text-center mb-8">
                        <h1 class="text-2xl font-black text-gray-800 mb-2">NOUR MENU</h1>
                        <p class="text-gray-600">Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ ÙˆÙŠÙˆØµÙ„Ùƒ Ù„Ø­Ø¯ Ø¨Ø§Ø¨ Ø§Ù„Ø¨ÙŠØª ğŸ”ğŸ </p>
                    </div>
                    <div class="space-y-3">
                        <button onclick="switchView('view-menu-order')" class="w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95">
                            <span>Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</span> <i class="fas fa-motorcycle"></i>
                        </button>
                        <button onclick="switchView('view-menu-only')" class="w-full bg-white border-2 border-orange-200 text-orange-600 hover:bg-orange-50 font-bold py-3 rounded-xl transition-colors">
                            ØªØµÙØ­ Ø§Ù„Ù…Ù†ÙŠÙˆ ÙÙ‚Ø·
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-menu-order" class="view-section">
        <header class="fixed top-0 inset-x-0 z-40 glass px-4 py-3">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="https://nour2030.neocities.org/NOUR%20Menu/Nour%20Menu.png" class="w-10 h-10 rounded-lg border border-gray-200">
                    <div>
                        <h2 class="font-bold text-sm theme-text-header">NOUR MENU</h2>
                        <p class="text-[10px] theme-text-body opacity-70">Ø·Ù„Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="toggleDarkMode()" class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 text-lg transition-colors">
                        <span id="darkIcon">ğŸŒ™</span>
                    </button>
                    <button onclick="switchView('view-landing')" class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 theme-text-header text-sm">
                        <i class="fas fa-home"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-4xl mx-auto mt-20 px-4">
            <div id="categoriesView" class="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-24"></div>
            <div id="itemsArea" class="hidden pb-24">
                <div class="sticky top-[65px] z-30 bg-white/95 dark:bg-gray-900/95 backdrop-blur py-2 mb-4 border-b theme-border flex items-center gap-2">
                    <button onclick="backToCategories()" class="bg-gray-100 dark:bg-gray-700 theme-text-header px-3 py-1.5 rounded-lg text-sm font-bold">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <h3 id="sectionTitle" class="font-bold theme-text-header text-lg flex-1">Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
                </div>
                <div id="itemsGrid" class="items-carousel"></div>
            </div>
        </main>

        <div id="miniCart" onclick="openCheckoutModal()" class="fixed bottom-4 left-4 right-4 bg-gray-900 dark:bg-pink-600 text-white p-4 rounded-xl shadow-2xl z-50 flex items-center justify-between cursor-pointer transform translate-y-24 transition-transform duration-300">
            <div class="flex items-center gap-3">
                <div class="bg-white/20 w-10 h-10 rounded-full flex items-center justify-center font-bold" id="miniCartCount">0</div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-300">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                    <span class="font-bold text-lg" id="miniCartTotal">0 Ø¬</span>
                </div>
            </div>
            <button class="bg-white text-gray-900 px-4 py-2 rounded-lg text-sm font-bold shadow">
                Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ <i class="fas fa-arrow-left mr-1"></i>
            </button>
        </div>
    </div>

    <div id="view-menu-only" class="view-section">
        <header class="fixed top-0 inset-x-0 z-40 glass px-4 py-3">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <h2 class="font-bold theme-text-header">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
                <div class="flex gap-2">
                    <button onclick="toggleDarkMode()" class="px-3 py-1 rounded bg-gray-100 dark:bg-gray-700 text-sm">ğŸŒ™</button>
                    <button onclick="switchView('view-landing')" class="px-3 py-1 rounded bg-gray-100 dark:bg-gray-700 text-sm">ğŸ </button>
                </div>
            </div>
        </header>
        <main class="max-w-4xl mx-auto mt-20 px-4 pb-10">
            <div id="categoriesViewOnly" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
            <div id="itemsAreaOnly" class="hidden">
                <button onclick="backToCategoriesOnly()" class="mb-4 bg-gray-200 dark:bg-gray-700 theme-text-header px-4 py-2 rounded-lg text-sm">Ø±Ø¬ÙˆØ¹</button>
                <div id="itemsGridOnly" class="items-carousel"></div>
            </div>
        </main>
    </div>

    <div id="optionModal" class="fixed inset-0 z-[101] hidden">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeOptionModal()"></div>
        <div class="absolute inset-x-0 bottom-0 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 bg-white dark:bg-gray-800 sm:rounded-2xl rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto w-full sm:max-w-md transition-transform duration-300 transform translate-y-full sm:translate-y-0" id="optionModalPanel">
            <div class="bg-[#6b3e26] dark:bg-pink-600 text-white p-4 flex items-center justify-between sticky top-0 z-10">
                <h3 class="font-bold text-lg" id="optionModalTitle">Ø§Ø®ØªØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</h3>
                <button onclick="closeOptionModal()" class="text-white/80 hover:text-white text-2xl font-bold">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <p id="optionModalDesc" class="text-sm text-gray-600 dark:text-gray-400"></p>
                <div id="itemOptionsContainer" class="space-y-4"></div>
                <button onclick="confirmAddToCart()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg shadow-xl transition-colors flex items-center justify-center gap-2">
                    Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© <span id="finalPriceDisplayOptionModal"></span>
                </button>
            </div>
        </div>
    </div>

    <div id="checkoutModal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeCheckoutModal()"></div>
        <div class="absolute inset-x-0 bottom-0 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 bg-white dark:bg-gray-800 sm:rounded-2xl rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto w-full sm:max-w-md transition-transform duration-300 transform translate-y-full sm:translate-y-0" id="modalPanel">
            <div class="bg-[#6b3e26] dark:bg-pink-600 text-white p-4 flex items-center justify-between sticky top-0 z-10">
                <h3 class="font-bold text-lg">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø¯ÙØ¹</h3>
                <button onclick="closeCheckoutModal()" class="text-white/80 hover:text-white text-2xl font-bold">&times;</button>
            </div>
            <div class="p-5 space-y-6">
                <div id="cartList" class="space-y-3 min-h-[50px] max-h-[150px] overflow-y-auto bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg"></div>

                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-200 dark:border-blue-800">
                    <label class="block text-xs font-bold text-blue-700 dark:text-blue-300 mb-2">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ Ø®ØµÙ…ØŸ</label>
                    <div class="flex gap-2">
                        <input type="text" id="couponInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§" class="flex-1 border border-blue-300 p-2 rounded-lg text-sm bg-white dark:bg-gray-700 outline-none">
                        <button onclick="applyCoupon()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs font-bold">ØªØ·Ø¨ÙŠÙ‚</button>
                    </div>
                    <p id="couponMsg" class="text-[10px] mt-1 font-bold"></p>
                </div>

                <fieldset class="border border-gray-200 dark:border-gray-700 p-4 rounded-xl space-y-4">
                    <legend class="text-base font-bold text-[var(--header-color)] px-2 theme-text-header">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</legend>
                    <input type="text" id="popName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ*" class="w-full border border-gray-300 p-3 rounded-lg text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none">
                    <input type="tel" id="popPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„*" class="w-full border border-gray-300 p-3 rounded-lg text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none">
                </fieldset>

                <fieldset class="border border-gray-200 dark:border-gray-700 p-4 rounded-xl space-y-3">
                    <legend class="text-base font-bold text-[var(--header-color)] px-2 theme-text-header">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</legend>
                    <div class="grid grid-cols-1 gap-2">
                        <label class="flex items-center gap-3 cursor-pointer p-2 border rounded-lg theme-border">
                            <input type="radio" name="payment_method_type" value="ÙƒØ§Ø´" checked onclick="togglePaymentInfo('cash')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">ğŸ’µ ÙƒØ§Ø´ (Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 border rounded-lg theme-border">
                            <input type="radio" name="payment_method_type" value="Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©" onclick="togglePaymentInfo('wallet')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">ğŸ“± Ù…Ø­ÙØ¸Ø© (01558090199)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 border rounded-lg theme-border">
                            <input type="radio" name="payment_method_type" value="Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ" onclick="togglePaymentInfo('instapay')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">ğŸ’¸ Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ (01224268026)</span>
                        </label>
                    </div>
                    <div id="paymentInstructions" class="hidden text-[11px] bg-orange-50 p-2 rounded border border-orange-200 text-orange-800">
                        ÙŠØ±Ø¬Ù‰ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¶Ø­ Ø£Ø¯Ù†Ø§Ù‡ Ø«Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨.
                    </div>
                </fieldset>

                <fieldset class="border border-gray-200 dark:border-gray-700 p-4 rounded-xl space-y-3">
                    <legend class="text-base font-bold text-[var(--header-color)] px-2 theme-text-header">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</legend>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 cursor-pointer p-2 rounded">
                            <input type="radio" name="order_type" value="ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨" checked onclick="updateOrderType('delivery')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ù†Ø²Ù„ (15 Ø¬)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 rounded">
                            <input type="radio" name="order_type" value="Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø­Ù„" onclick="updateOrderType('pickup')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø­Ù„ (Ù…Ø¬Ø§Ù†ÙŠ)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 rounded">
                            <input type="radio" name="order_type" value="Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ØµØ§Ù„Ø©" onclick="updateOrderType('dinein')" class="w-5 h-5 accent-green-600">
                            <span class="theme-text-body font-medium">Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ØµØ§Ù„Ø© (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ù„)</span>
                        </label>
                    </div>
                    
                    <div id="addressFields">
                        <input type="text" id="popAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="w-full border border-gray-300 p-3 rounded-lg text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none">
                    </div>
                    <div id="tableFields" class="hidden">
                        <input type="number" id="popTable" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©*" class="w-full border border-gray-300 p-3 rounded-lg text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none">
                    </div>
                </fieldset>

                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-xl border theme-border space-y-2 text-sm">
                    <div class="flex justify-between"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span> <span id="subTotalDisplay">0 Ø¬</span></div>
                    <div id="discountDisplay" class="flex justify-between text-blue-600 font-bold hidden"><span>Ø§Ù„Ø®ØµÙ…:</span> <span id="discountVal">0 Ø¬</span></div>
                    <div id="deliveryFeeDisplay" class="flex justify-between text-red-500"><span>Ø§Ù„ØªÙˆØµÙŠÙ„:</span> <span>15 Ø¬</span></div>
                    <div class="flex justify-between border-t theme-border pt-2 font-extrabold text-lg">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span> <span id="modalFinalTotal" class="text-red-600">0 Ø¬</span>
                    </div>
                </div>

                <button onclick="processOrder()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg shadow-xl flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp text-2xl"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                </button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-xl z-[150] transition-all duration-300 opacity-0 pointer-events-none translate-y-[-20px] text-sm font-bold">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…</div>

    <script>
        const SHOP_NAME = 'NOUR MENU';
        const SHOP_NUMBER = '201224268026';
        const DELIVERY_FEE = 15;
        const SERVICE_FEE = 1;
        
        let currentOrderType = 'delivery';
        let cart = JSON.parse(localStorage.getItem('NOUR MENU_cart')) || [];
        let itemToProcess = null;
        let discountPercent = 0;
        let appliedCoupon = '';
        let selectedOptionId = null;

        const menuItems = [
            { id: 101, name: "Ù…Ù†Ø§Ù‚ÙŠØ´ Ø²Ø¹ØªØ±", desc: "Ø²Ø¹ØªØ± ÙˆØ²ÙŠØª Ø²ÙŠØªÙˆÙ† ÙØ§Ø®Ø±", category:"ÙØ·Ø§Ø¦Ø±", img: "https://nour2030.neocities.org/NOUR%20Menu/mn2esh.jpg", options: [{ option_id: 1, name: "ØµØºÙŠØ±", price: 30 }, { option_id: 2, name: "ÙƒØ¨ÙŠØ±", price: 45 }] },
            { id: 201, name: "ÙƒØ±ÙŠØ¨ Ù†ÙˆØªÙŠÙ„Ø§", desc: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ù†ÙˆØªÙŠÙ„Ø§ ÙˆÙ…ÙˆØ²", category:"Ø­Ù„ÙˆÙŠØ§Øª", img: "https://nour2030.neocities.org/NOUR%20Menu/nutella.jpg", options: [{ option_id: 1, name: "Ø¹Ø§Ø¯ÙŠ", price: 50 }, { option_id: 2, name: "ÙƒØ¨ÙŠØ±", price: 70 }] },
            { id: 202, name: "ÙƒØ±ÙŠØ¨ Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§", desc: "Ø¬Ø¨Ù†Ù‡ Ø¨Ø§Ù„Ø®Ø¶Ø§Ø±", category:"Ø­Ù„ÙˆÙŠØ§Øª", img: "https://nour2030.neocities.org/NOUR%20Menu/motzarela.jpg", options: [{ option_id: 1, name: "ØµØºÙŠØ±", price: 50 }, { option_id: 2, name: "ÙƒØ¨ÙŠØ±", price: 70 }] },
            { id: 203, name: "ÙƒØ±ÙŠØ¨ Ø³Ø­Ù‚", desc: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø³Ø¬Ù‚ ", category:"Ø­Ù„ÙˆÙŠØ§Øª", img: "https://nour2030.neocities.org/NOUR%20Menu/sogog.jpg", options: [{ option_id: 1, name: "Ø¹Ø§Ø¯ÙŠ", price: 50 }, { option_id: 2, name: "ÙƒØ¨ÙŠØ±", price: 70 }] },
            { id: 301, name: "Ø¨Ø±Ø¬Ø± ÙƒÙ„Ø§Ø³ÙŠÙƒ", desc: "Ù„Ø­Ù… Ø¨Ù„Ø¯ÙŠ 150 Ø¬Ø±Ø§Ù…", category:"Ø¨Ø±Ø¬Ø±", img: "https://nour2030.neocities.org/Menu/%D8%A8%D8%B1%D8%AC%D8%B1%20%D9%83%D9%84%D8%A7%D8%B3%D9%8A%D9%83.jpg", options: [ { option_id: 1, name: "Ø¨Ø±Ø¬Ø± 150 Ø¬Ø±Ø§Ù…", price: 60 } ] },
            { id: 302, name: "Ø¨Ø±Ø¬Ø± Ø§Ù„Ø§Ø³Ø·ÙˆØ±Ù‡", desc: "Ù„Ø­Ù… Ø¨Ù„Ø¯ÙŠ 200 Ø¬Ø±Ø§Ù…", category:"Ø¨Ø±Ø¬Ø±", img: "https://nour2030.neocities.org/NOUR%20Menu/Oman_Egypt-Ranch-Chicken-PR-scaled.jpg", options: [{ option_id: 1, name: "Ø¹Ø§Ø¯ÙŠ", price: 50 }, { option_id: 2, name: "ÙƒØ¨ÙŠØ±", price: 70 }] },
            { id: 501, name: "ÙˆØ¬Ø¨Ø© ÙƒÙØªØ©", desc: "Ø£Ø±Ø² ÙˆØ³Ù„Ø·Ø© ÙˆØ·Ø­ÙŠÙ†Ø©", category:"ÙˆØ¬Ø¨Ø§Øª", img: "https://nour2030.neocities.org/NOUR%20Menu/kofta.jpeg", options: [{ option_id: 1, name: "3 Ù‚Ø·Ø¹", price: 40 }, { option_id: 2, name: "5 Ù‚Ø·Ø¹", price: 65 }] },
            { id: 401, name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ", desc: "Ø¨Ù† Ù…Ø­ÙˆØ¬ ÙØ§Ø®Ø±", category:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª", img: "https://nour2030.neocities.org/Menu/%D9%82%D9%87%D9%88%D9%87%20%D8%AA%D8%B1%D9%83%D9%8A.jpg", options: [{ option_id: 1, name: "Ø³Ø§Ø¯Ø©", price: 15 }, { option_id: 2, name: "Ù…Ø¸Ø¨ÙˆØ·", price: 15 }, { option_id: 3, name: "Ø²ÙŠØ§Ø¯Ø©", price: 15 }] }
        ];

        window.onload = () => {
            if(localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');
            setTimeout(() => { 
                document.getElementById('app-splash').style.opacity = '0'; 
                setTimeout(() => { document.getElementById('app-splash').style.display = 'none'; }, 500); 
            }, 2000);
            renderCart();
        };

        function updateOrderType(type) {
            currentOrderType = type;
            document.getElementById('addressFields').classList.toggle('hidden', type !== 'delivery');
            document.getElementById('tableFields').classList.toggle('hidden', type !== 'dinein');
            renderCart();
        }

        function togglePaymentInfo(mode) {
            const info = document.getElementById('paymentInstructions');
            if (mode === 'cash') info.classList.add('hidden');
            else info.classList.remove('hidden');
        }

        function generateOrderID() {
            const now = new Date();
            const dateStr = now.getFullYear().toString() + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0');
            return `ORD-${dateStr}-${Math.floor(1000 + Math.random() * 9000)}`;
        }

        function applyCoupon() {
            const input = document.getElementById('couponInput').value.trim().toLowerCase();
            const msg = document.getElementById('couponMsg');
            if(input === 'haytham') {
                discountPercent = 0.10;
                appliedCoupon = 'haytham';
                msg.textContent = "ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… 10% âœ…";
                msg.className = "text-[10px] mt-1 font-bold text-green-600";
            } else {
                discountPercent = 0;
                appliedCoupon = '';
                msg.textContent = "ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ âŒ";
                msg.className = "text-[10px] mt-1 font-bold text-red-600";
            }
            renderCart();
        }

        function renderCart() {
            const subtotal = cart.reduce((a,b) => a + (b.price * b.qty), 0);
            const discountAmount = Math.round(subtotal * discountPercent);
            let total = (subtotal - discountAmount) + SERVICE_FEE;
            if (currentOrderType === 'delivery') total += DELIVERY_FEE;

            const miniCart = document.getElementById('miniCart');
            if(cart.length > 0) miniCart.classList.remove('translate-y-24');
            else miniCart.classList.add('translate-y-24');

            document.getElementById('miniCartCount').textContent = cart.reduce((a,b) => a + b.qty, 0);
            document.getElementById('miniCartTotal').textContent = total + ' Ø¬';

            const list = document.getElementById('cartList');
            list.innerHTML = cart.length === 0 ? '<div class="text-center py-4 text-gray-400">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>' : 
                cart.map(item => `
                    <div class="flex items-center justify-between bg-white dark:bg-gray-700/50 p-2 rounded-lg border theme-border">
                        <div class="text-sm font-bold theme-text-header">${item.name} <span class="text-xs text-gray-400 block">${item.optionName}</span></div>
                        <div class="flex items-center gap-3">
                            <button onclick="updateQty('${item.cartItemId}', -1)" class="w-6 h-6 bg-gray-200 dark:bg-gray-600 rounded">-</button>
                            <span class="font-bold w-4 text-center">${item.qty}</span>
                            <button onclick="updateQty('${item.cartItemId}', 1)" class="w-6 h-6 bg-green-100 text-green-700 rounded">+</button>
                        </div>
                        <div class="text-sm font-bold">${item.price * item.qty} Ø¬</div>
                    </div>`).join('');

            document.getElementById('subTotalDisplay').textContent = subtotal + ' Ø¬';
            document.getElementById('modalFinalTotal').textContent = total + ' Ø¬';
            
            const discEl = document.getElementById('discountDisplay');
            if(discountAmount > 0) {
                discEl.classList.remove('hidden');
                document.getElementById('discountVal').textContent = `-${discountAmount} Ø¬`;
            } else { discEl.classList.add('hidden'); }
            document.getElementById('deliveryFeeDisplay').classList.toggle('hidden', currentOrderType !== 'delivery');
        }

        function processOrder() {
            const name = document.getElementById('popName').value.trim();
            const phone = document.getElementById('popPhone').value.trim();
            const address = document.getElementById('popAddress').value.trim();
            const tableNum = document.getElementById('popTable').value.trim();
            const payMethod = document.querySelector('input[name="payment_method_type"]:checked').value;

            if(!name || !phone) return alert('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
            if(currentOrderType === 'delivery' && !address) return alert('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');
            if(currentOrderType === 'dinein' && !tableNum) return alert('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©');

            const orderID = generateOrderID();
            const subtotal = cart.reduce((a,b)=>a+(b.price*b.qty),0);
            const discountAmount = Math.round(subtotal * discountPercent);
            let total = (subtotal - discountAmount) + SERVICE_FEE;
            if(currentOrderType === 'delivery') total += DELIVERY_FEE;

            let typeLabel = currentOrderType === 'delivery' ? `ğŸ›µ ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ (${address})` : (currentOrderType === 'dinein' ? `ğŸ½ï¸ Ø·Ù„Ø¨ ØµØ§Ù„Ø© - Ø·Ø§ÙˆÙ„Ø© Ø±Ù‚Ù…: ${tableNum}` : `ğŸ›ï¸ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø­Ù„`);

            let msg = `ğŸª *${SHOP_NAME}*\n`;
            msg += `ğŸ“„ *Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* ${orderID}\n`;
            msg += `------------------\n`;
            msg += `ğŸ‘¤ *Ø§Ù„Ø¹Ù…ÙŠÙ„:* ${name}\nğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* ${phone}\n`;
            msg += `ğŸ“ *Ø§Ù„Ù†ÙˆØ¹:* ${typeLabel}\n`;
            msg += `ğŸ’³ *Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:* ${payMethod}\n`;
            msg += `------------------\n*Ø§Ù„Ø£ØµÙ†Ø§Ù:*\n`;
            cart.forEach(i => msg += `- ${i.qty} x ${i.name} (${i.optionName}) = ${i.price * i.qty}Ø¬\n`);
            msg += `------------------\n`;
            msg += `*Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:* ${subtotal} Ø¬\n`;
            if(discountAmount > 0) msg += `*Ø®ØµÙ… (${appliedCoupon}):* -${discountAmount} Ø¬\n`;
            if(currentOrderType === 'delivery') msg += `*Ø§Ù„ØªÙˆØµÙŠÙ„:* ${DELIVERY_FEE} Ø¬\n`;
            msg += `*Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:* ${total} Ø¬`;

            window.open(`https://wa.me/${SHOP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
            cart = []; saveCart(); renderCart(); closeCheckoutModal();
        }

        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'view-menu-order') renderCategories('categoriesView', 'itemsArea', false);
            if(id === 'view-menu-only') renderCategories('categoriesViewOnly', 'itemsAreaOnly', true);
        }

        function renderCategories(cid, aid, ro) {
            const cont = document.getElementById(cid);
            const cats = [...new Set(menuItems.map(i => i.category))];
            cont.innerHTML = cats.map(c => `<div onclick="showItems('${c}', '${cid}', '${aid}', ${ro})" class="bg-white dark:bg-gray-800 p-2 rounded-xl shadow border theme-border flex flex-col items-center"><img src="${menuItems.find(i=>i.category===c).img}" class="w-full h-24 object-cover rounded-lg mb-2"><span class="font-bold text-sm">${c}</span></div>`).join('');
            cont.classList.remove('hidden');
            document.getElementById(aid).classList.add('hidden');
        }

        function showItems(cat, cid, aid, ro) {
            document.getElementById(cid).classList.add('hidden');
            document.getElementById(aid).classList.remove('hidden');
            const grid = document.getElementById(ro ? 'itemsGridOnly' : 'itemsGrid');
            grid.innerHTML = menuItems.filter(i => i.category === cat).map(i => `<div class="bg-white dark:bg-gray-800 rounded-xl shadow overflow-hidden flex flex-col border theme-border"><img src="${i.img}" class="w-full h-40 object-cover"><div class="p-3"> <div class="flex justify-between font-bold mb-2"><h4>${i.name}</h4><span class="text-green-600">${i.options[0].price}Ø¬</span></div><p class="text-xs text-gray-400 mb-3">${i.desc}</p>${!ro ? `<button onclick="openOptionModal(${i.id})" class="w-full bg-primary text-white py-2 rounded-lg text-sm">Ø§Ø®ØªÙŠØ§Ø±</button>` : ''}</div></div>`).join('');
        }

        function openOptionModal(id) {
            itemToProcess = menuItems.find(i => i.id === id);
            document.getElementById('optionModalTitle').textContent = itemToProcess.name;
            document.getElementById('itemOptionsContainer').innerHTML = itemToProcess.options.map(o => `<button onclick="selectOption(${o.option_id}, ${o.price})" id="optionBtn_${o.option_id}" class="option-button w-full text-right p-3 rounded-xl flex justify-between"><span>${o.name}</span><b>${o.price}Ø¬</b></button>`).join('');
            selectOption(itemToProcess.options[0].option_id, itemToProcess.options[0].price);
            document.getElementById('optionModal').classList.remove('hidden');
            setTimeout(() => { document.getElementById('optionModalPanel').classList.remove('translate-y-full'); }, 10);
        }

        function selectOption(oid, p) {
            selectedOptionId = oid;
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            document.getElementById(`optionBtn_${oid}`).classList.add('selected');
            document.getElementById('finalPriceDisplayOptionModal').textContent = `(${p} Ø¬)`;
        }

        function confirmAddToCart() {
            const opt = itemToProcess.options.find(o => o.option_id === selectedOptionId);
            const cartItemId = Date.now().toString();
            cart.push({ cartItemId, id: itemToProcess.id, name: itemToProcess.name, optionName: opt.name, price: opt.price, qty: 1 });
            saveCart(); renderCart(); closeOptionModal(); showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©');
        }

        function updateQty(id, delta) {
            const idx = cart.findIndex(i => i.cartItemId === id);
            if(idx > -1) {
                cart[idx].qty += delta;
                if(cart[idx].qty < 1) cart.splice(idx, 1);
                saveCart(); renderCart();
            }
        }

        function clearCart() { if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©ØŸ')) { cart = []; saveCart(); renderCart(); } }
        function saveCart() { localStorage.setItem('NOUR MENU_cart', JSON.stringify(cart)); }
        function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.style.opacity = '1'; t.style.transform = 'translate(-50%, 0)'; setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, -20px)'; }, 2000); }
        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); const isDark = document.documentElement.classList.contains('dark'); localStorage.setItem('theme', isDark ? 'dark' : 'light'); document.getElementById('darkIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™'; }
        function openCheckoutModal() { document.getElementById('checkoutModal').classList.remove('hidden'); setTimeout(() => { document.getElementById('modalPanel').classList.remove('translate-y-full'); }, 10); renderCart(); }
        function closeCheckoutModal() { document.getElementById('modalPanel').classList.add('translate-y-full'); setTimeout(() => { document.getElementById('checkoutModal').classList.add('hidden'); }, 300); }
        function closeOptionModal() { document.getElementById('optionModalPanel').classList.add('translate-y-full'); setTimeout(() => { document.getElementById('optionModal').classList.add('hidden'); }, 300); }
        function backToCategories() { document.getElementById('itemsArea').classList.add('hidden'); document.getElementById('categoriesView').classList.remove('hidden'); }
        function backToCategoriesOnly() { document.getElementById('itemsAreaOnly').classList.add('hidden'); document.getElementById('categoriesViewOnly').classList.remove('hidden'); }
    </script>
</body>
</html>
